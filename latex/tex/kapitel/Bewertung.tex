\chapter{Ergebnis}

In diesem Kapitel werden die \hyperref[chap:entscheidungssysteme]{Entscheidungssysteme} Finite State Machine (FSM), Behavior Tree (BT) und Goal Oriented Action Planning (GOAP) aus der Erfahrung durch die Implementation, Benchmarks, wissenschaftlicher Literatur verglichen und folglich bewertet.

Der Vergleich wird sich auf die folgenden Punkte fokussieren: Erlernbarkeit, Umsetzung, Skalierbarkeit, Debugging, Performance und Speicherverbrauch. 

Für den Vergleich der Performance und Speicherverbrauch werden Ergebnisse von Benchmarks einbezogen.

\section{Ergebnisse der Implementierung}

In Kapitel\ref{} wird das Lösungskonzept beschrieben. Dort wird erläutert, dass die Bewertung der Entscheidungssysteme auf wissenschaftlicher Literatur sowie praktischen Erfahrungen basiert. Letztere ergeben sich aus der Implementierung der drei Entscheidungssysteme in einem spezifischen Szenario und fließen in die abschließenden Vergleich ein. Die Implementation des Szenario wird im Kapitel\ref{} beschrieben.


\subsection{Erlernbarkeit}

Die Erlernbarkeit beschreibt, wie komplex es für Entwickler ist, das jeweilige Entscheidungssystem zu verstehen und anzuwenden. Sie hängt von mehreren Faktoren ab. Dazu gehört die Verständlichkeit der Konzepte, die Verfügbarkeit von Dokumentationen sowie die notwendigen Vorkenntnisse für die Nutzung.

%FSM
Die FSM ist leicht verständlich. Sie wird häufig als Einführungsbeispiel in die Game-AI Entscheidungssysteme genommen, wie es in vielen Fachbüchern, wie \autocite{}, zur Game-AI ersichtlich ist. Es gibt genügend Internet Quellen, welche eine FSM Implementation dokumentieren. Hauptsächlich werden Kenntnisse über endliche Automaten benötigt. Im Vergleich zu den anderen Entscheidungssystemen ist sie am einfachsten zu erlernen.

%BT
Aufgrund der verschiedenen Task-Kategorien\ref{} ist der BT anspruchsvoller in der Anwendung und Einführung als die Finite State Machine (FSM). Kenntnisse in der Graphentheorie, insbesondere über gerichtete Graphen\ref{}, sind für das Verständnis eines BT von Vorteil. Sie hat ebenfalls viele Dokumentationen zur Implementation.

%GOAP
Mit dem dynamischen System kommt die Komplexität der Funktionsweise. GOAP wird im Gegensatz zu den anderen beiden Entscheidungssysteme für fortgeschrittene Entwickler empfohlen. Kenntnisse im Bereich von Graphentheorie und Suchalgorithmen können das Verständnis und die Nutzung von GOAP jedoch erheblich erleichtern. In Bezug auf Dokumentation und verfügbare Bibliotheken weist GOAP deutliche Mängel auf. Wie bereits im Kapitel\ref{} erläutert, fordern Studien wie \autocite{sielicki2018adaptation} eine stärkere Verbreitung von Dokumentationen und Bibliotheken für GOAP. Im Vergleich zu den anderen Entscheidungssystemen gibt es zu GOAP deutlich weniger Dokumentation.


\subsection{Umsetzung}

Bei der Umsetzung liegt der Fokus auf der praktischen Umsetzung des Entscheidungssystems in der Game-Engine Godot. Dabei wird betrachtet, wie aufwendig die Implementierung der Funktionsweise und Architektur des Entscheidungssystems ist sowie das designen der NPCs.

%FSM
Die FSM ist als Ad-Hoc-Authoring Methode ein statisches Entscheidungssystem und in Godot unkompliziert zu implementieren. Die Architektur besteht dabei aus einer Knoten Klasse und einer Koordinaten Klasse. Einen Knoten zu erstellen und diesen mit Aktions Komponenten zu ergänzen ist einfach. Doch mit der größe der Komplexität eines NPC steigt der Aufwand die FSM instandzuhalten, da mit der Anzahl an Aktionen die Anzahl der Knoten im Graphen steigen.

%BT
Auch der BT ist als Ad-Hoc-Authoring Methode ein statisches Entscheidungssystem und in Godot unkompliziert zu implementieren. Im Vergleich zur FSM hat er aber durch die verschiedenen Task-Typen\ref{} eine komplexere Architektur. Die Architektur ist aber unaufwendig zu realisieren und man hat durch die verschiedenen Kategorien der Tasks die Möglichkeit komplexere NPC Verhalten umzusetzen. Dennoch wird der BT als zu statisch empfunden.\autocite{aiag}. Zudem müssen Entwickler viel Zeit darauf verwenden, passende BT-Knoten zu erstellen und sie mit den richtigen Verhaltensweisen verknüpfen.\autocite{Schwab2021} Wie bereits in den zuvor erläuterten Studien aus dem Kapitel\ref{chap:sota bt}, kann die Struktur eines BT jedoch durch Methoden wie maschinelles Lernen oder GOAP automatisch generiert werden.

%GOAP
Der GOAP ist als dynamisches System das komplexeste der drei Entscheidungssysteme, wenn es um die Implementierung geht. Sie erfordert ein tiefgehendes Verständnis der Funktionsweise von GOAP. Hat man diese jedoch verstanden, können immersive NPC-Verhalten designed werden. Hinzu kommt das Godot 4.3 Datenstrukturen, wie Sets und PriorityQueues nicht beinhaltet, sodass diese für bessere Zugriffszeiten selbst implementiert werden müssen. Beim Designen von NPC-Verhalten ist insbesondere die Zuweisung der Kosten einer Aktion eine Herausforderung \autocite{Schwab2021}. Doch mit der Komplexität ist es möglich immersive NPC-Verhaltensweisen zu programmieren.


\subsection{Skalierbarkeit}

Der Punkt Skalierbarkeit bewertet, wie komplex es ist das System mit Aktionen zu erweitern oder bestehende zu ändern.

%FSM
Die FSM ist schwer skalierbar. Wird eine Aktion (Knoten) geändert oder hinzugefügt, so muss der Graph der FSM angepasst werden. Eine Änderung oder das Hinzufügen einer Aktion kann dazu führen, dass andere Knoten die mit der Aktion in Verbindung stehen ebenfalls geändert werden müssen. Dies kann zu einem Dominoeffekt führen, bei der eine Kette an Knoten geändert werden muss und wiederum Zeitaufwand bedeutet. Zustände und Übergänge sollten dabei vollständig definiert sein, so dass der NPC nicht in falschen Zuständen hängen bleibt. Die FSM wird mit jeder Erweiterung an Aktionen auch unübersichtlicher. So hatte das Spiel Half-Life (1998) ca. 80 so genannte Tasks, welche alle einem Zustand zugewiesen sind.\autocite{U2023} Die Unübersichtlichkeit führt zur erhöhten Komplexität des Entscheidungssystems. Außerdem können Leistungsprobleme auftreten, insbesondere bei einer übermäßigen Anzahl von Knoten.\autocite{U2023}

%BT
Wie auch die FSM ist der BT ein statisches Entscheidungssystem. Er ist jedoch im Vergleich zu FSM skalierbarer. Die Aktionen eines Behavior Tree sind durch die Tasks loser gekoppelt und müssen sich nicht gegenseitig stark beeinflussen. So kann bei einer Erweiterung ein neuer Zweig hinzugefügt werden mit seinen eigenen Tasks, ohne viele bestehende Aktionen oder Strukturen zu verändern.\autocite{aiag}  Allerdings kann auch ein BT mit zunehmender Anzahl an Aktionen unübersichtlich werden. Erfahrung zeigt, dass das Lesen und Verstehen eines Behavior Trees schwieriger ist als bei einer FSM. Wobei es Literaturen wie \autocite{} gibt die das Gegenteil behaupten.

%GOAP
Das Entscheidungssystem GOAP ist hinsichtlich der Skalierbarkeit den zuvor beschriebenen Systemen überlegen. Es müssen bei neuen Aktionen oder Änderungen bestehender Aktionen keine manuellen Verknüpfungen getätigt werden, da alle Aktionen unabhängig voneinander existieren. Die Reihenfolge der Aktionsausführung wird dynamisch durch GOAP bestimmt, was es zu einem anpassungsfähigen Entscheidungssystem macht.


\subsection{Debugging}

Das Debugging beschreibt, wie komplex Fehler im Entscheidungssystem gefunden und behoben werden können. 

%FSM
Das Debuggen einer FSM ist vergleichsweise einfach \autocite{review_game_ai}, da ihre Struktur statisch ist und sich nicht dynamisch verändert. Durch die Visualisierung des Graphen lässt sich nachvollziehen, welche Knoten zur ausgeführten Aktion geführt haben. Speichert man zusätzlich die zuletzt durchlaufenen Knoten und gibt diese aus, kann der Ablauf noch besser nachvollzogen und mögliche Fehlerquellen leichter identifiziert werden.

%BT
Auch das Debuggen soll laut Quellen wie \autocite{aiag} und \autocite{review_game_ai} einfacher sein. Insbesondere durch die Tasks und ihre Rückgabewerte lässt sich nachvollziehen, welche Pfade im Baum durchlaufen wurden. Eine Visualisierung ist ebenfalls möglich und kann das Verständnis zusätzlich erleichtern.

%GOAP
Ein Nachteil der mit dem dynamischen System kommt ist das Debuggen. Es ist es schwierig, die mögliche Reihenfolge der Aktionen vorherzusagen, da GOAP die Aktionen basierend auf ihren Kosten und Zuständen auswählt und nicht durch statische Verbindungen, wie es in Ad-hoc-Behavior-Authoring-System der Fall ist. Eine mögliche Lösung wäre eine Visualisierung des Suchbaums, wie er durch den A*-Algorithmus in GOAP generiert wird. Eine solche Darstellung würde aufzeigen, welche Aktionen potenziell in Frage kamen und welche letztendlich priorisiert wurden. Allerdings ist die Implementierung dieser Visualisierung deutlich komplexer als bei einer FSM oder einem BT.


\section{Ergebnise der Benchmarks}

%FSM
Außerdem können Leistungsprobleme auftreten, insbesondere bei einer übermäßigen Anzahl von Zuständen.\autocite{U2023} 


\begin{figure}[h]
  \centering
  \includegraphics[width=16cm]{Vergleich/avg_fps}
	\captionsetup{justification=justified, format=plain}
  \caption{FPS-Performance Benchmark}
  \label{FPS-Performance Benchmark}
\end{figure}


\section{Bewertung}

Die Wahl des Entscheidungssystems hängt stark von den Anforderungen des Projekts ab.

Eine Finite State Machine wird für einfache NPC-Logiken empfohlen. Sie ist von den anderen zwei Entscheidungssystem am einfachsten zu erlernen und in Godot umzusetzen. Will man aber komplexe NPC-Verhalten programmieren, so wird die Anzahl der Knoten wachsen, der FSM-Graph unübersichtlicher und die Wartbarkeit wird schwieriger. Die Erweiterung durch weitere Knoten kann zur Anpassung der FSM führen und somit zu einem erhöhten Zeitaufwand. Das Debuggen ist jedoch durch die statische Natur der FSM vergleichsweise einfach, insbesondere wenn eine Visualisierung genutzt wird.

Für mittlere bis komplexe NPC-Verhaltensweisen ist der Behavior Tree zu empfehlen. Er ist in ihrer Funktionsweise komplexer als die FSM, hat aber viel Dokumentation zur Umsetzung, die in Godot ohne Schwierigkeiten möglich ist. Es gibt viele Konzepte die das 
Die Skalierbarkeit und Debuggen des BT ist ebenfalls einfach.

Will man komplexe NPC-Verhalten umsetzen, so ist GOAP die beste Wahl. Mit der komplexen Funktionsweise und eher mageren Dokumentation ist es schwierig, sich einzuarbeiten. In Bezug auf Skalierbarkeit übertrifft GOAP die anderen Systeme, da neue Aktionen unabhängig voneinander existieren und nicht manuell verknüpft werden müssen. Dies macht GOAP besonders anpassungsfähig. Allerdings ist das Debuggen aufgrund der dynamischen Entscheidungen schwieriger. Eine mögliche Lösung wäre die Visualisierung des Suchbaums, jedoch ist dies deutlich aufwendiger zu implementieren als bei FSM oder BT.

Die Tabelle\ref{tab:es vergleich tabelle} veranschaulicht die abschließende Bewertung der Entscheidungssysteme mithilfe von Harvey Balls. Je voller der Harvey Ball, desto besser die Bewertung. Die Bewertungen basieren auf Vergleichen und Benchmarks.


\begin{table}[h]
  \caption{Tabellarische Bewertung}
  \label{tab:es vergleich tabelle}
  \centering
  \begin{tabular}{lccc}
    \toprule
    & Finite State Machine & Behavior Tree & GOAP\\
    \midrule
		Erlernbarkeit & \harveyBallFull & \harveyBallThreeQuarter & \harveyBallHalf\\
    Implementation	& \harveyBallFull  & \harveyBallThreeQuarter  & \harveyBallHalf\\
		NPC-Design & \harveyBallQuarter & \harveyBallThreeQuarter & \harveyBallFull\\
    Skalierbarkeit	& \harveyBallQuarter & \harveyBallHalf & \harveyBallFull\\
    Debugging	& \harveyBallHalf & \harveyBallThreeQuarter & \harveyBallQuarter\\
		Performance & \harveyBallFull & \harveyBallThreeQuarter & \harveyBallHalf\\
		Speicherverbrauch & \harveyBallFull & \harveyBallThreeQuarter & \harveyBallHalf\\
    \bottomrule
  \end{tabular}
\end{table}